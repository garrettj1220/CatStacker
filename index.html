<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>CatStacker</title>
    <link id="main-stylesheet" rel="stylesheet" href="styles.css" />
    <script>
      (() => {
        const link = document.getElementById("main-stylesheet");
        if (!link) return;
        const baseHref = (link.getAttribute("href") || "").split("?")[0] || "styles.css";
        link.href = `${baseHref}?t=${Date.now()}`;
      })();
    </script>
  </head>
  <body>
    <main>
      <canvas id="game-canvas" width="960" height="640"></canvas>
      <div id="main-menu" class="main-menu">
        <div class="main-menu-content">
          <div class="main-menu-headline">
            <h1>CatStacker</h1>
            <p class="menu-lede">Stack cats. Its fun.</p>
            <button id="audio-toggle" class="audio-toggle" type="button" aria-label="Toggle audio" aria-pressed="false">
              <img id="audio-toggle-icon" src="Art/Icons/volume-on.svg" alt="" />
            </button>
          </div>
          <div class="cat-grid" aria-hidden="true">
            <div class="cat-card cat-card-one"></div>
            <div class="cat-card cat-card-two"></div>
            <div class="cat-card cat-card-three"></div>
          </div>
          <div class="mode-buttons">
            <button id="mode-survival" class="mode-btn" data-mode="survival">Survival</button>
            <button id="mode-checkpoint" class="mode-btn" data-mode="checkpoint">Checkpoint Run</button>
          </div>
          <div class="best-scores">
            <p>Best Survival Score: <span id="best-survival-score">0</span></p>
            <p>Best Checkpoint Run Score: <span id="best-checkpoint-score">0</span></p>
          </div>
          <div class="shop-bar">
            <button id="shop-button" class="shop-btn" type="button">Visit Shop</button>
            <p class="shop-points-label">Shop Points: <span id="shop-points-value">0</span></p>
          </div>
          <p class="menu-credit">By GarrettJPG</p>
        </div>
      </div>
      <aside id="unlock-panel" class="unlock-panel" aria-live="polite">
        <div class="unlock-header">
          <h2>Cat Ladder</h2>
        </div>
        <div class="unlock-track">
          <div id="unlock-fill" class="unlock-fill"></div>
        </div>
        <ul id="unlock-list" class="unlock-list"></ul>
      </aside>
      <div class="record-track" aria-live="polite">
        <span class="record-line top-line">Top Score: <span id="top-score-value">0</span></span>
      </div>
      <div id="shop-panel" class="overlay hidden shop-overlay">
        <div class="panel shop-panel-content">
          <header class="shop-header">
            <h1>Cosmetic Shop</h1>
            <button id="shop-close" class="shop-close" type="button">✕</button>
          </header>
          <p class="shop-panel-points">
            Points: <span id="shop-panel-points">0</span>
          </p>
          <div class="shop-categories" id="shop-categories">
            <button class="shop-category active" data-category="platforms">Platforms</button>
          </div>
          <div class="shop-grid" id="shop-grid">
            <div class="shop-grid-empty">Loading items...</div>
          </div>
        </div>
      </div>
      <div id="shop-popup" class="shop-popup hidden">
        <div class="shop-popup-content">
          <button class="shop-popup-close" type="button">✕</button>
          <img id="shop-popup-image" alt="Platform unlocked" />
          <p id="shop-popup-text">Unlocked</p>
        </div>
      </div>
      <div id="level-overlay" class="level-overlay hidden">
        <div class="level-text">Level <span id="overlay-level">1</span></div>
      </div>
      <div id="pause-menu" class="overlay hidden">
        <div class="panel pause-panel">
          <h1>Paused</h1>
          <div class="overlay-actions">
            <button id="pause-resume" type="button">Resume</button>
            <button id="pause-menu-home" type="button">Main Menu</button>
          </div>
        </div>
      </div>
      <div id="game-over" class="overlay hidden">
        <div class="panel">
          <h1 id="game-over-title">Game Over</h1>
          <p id="game-over-text">Your score: 0</p>
          <p>Level reached: <span id="final-level">1</span></p>
          <p>Height reached: <span id="final-height">0</span> cats</p>
          <p>Score: <span id="final-score">0</span></p>
          <div class="overlay-actions">
            <button id="game-over-play-again" type="button">Play Again</button>
            <button id="game-over-main-menu" type="button">Main Menu</button>
          </div>
        </div>
      </div>
      <div id="victory-screen" class="overlay hidden">
        <div class="panel victory-panel">
          <h1>Victory!</h1>
          <p id="victory-mode">You beat CatStacker in Survival mode.</p>
          <div id="victory-gallery" class="victory-gallery"></div>
          <div class="overlay-actions">
            <button id="victory-play-again" type="button">Play Again</button>
            <button id="victory-main-menu" type="button">Main Menu</button>
          </div>
        </div>
      </div>
      <div class="hud">
        <p class="level-label">Level <span id="level-value">1</span></p>
        <p class="score">Score: <span id="score-value">0</span></p>
        <p class="height">Height: <span id="height-value">0</span></p>
        <div class="wobble">
          <span class="label">Wobble</span>
          <div class="meter">
            <div id="wobble-bar"></div>
          </div>
          <div id="heart-row" class="heart-row" aria-label="Lives"></div>
        </div>
      </div>
      <div id="slippery-warning" class="slippery-warning hidden">
        <img src="Art/Icons/skull.svg" alt="Skull warning" />
        <span>Cats may be slippery</span>
      </div>
    </main>
    <script>
      const script = document.createElement("script");
      script.type = "module";
      script.src = `game.js?t=${Date.now()}`;
      document.body.appendChild(script);
    </script>
  </body>
</html>
